<div id="accTransaction" class='hide'>
    <div>${uiLabelMap.accCreateNew}</div>
	<div class="form-window-container">
		<div class='form-window-content'>
			<div class='row-fluid'>
				<div class='span6'>
					<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label class="asterisk">${uiLabelMap.FormFieldTitle_acctgTransTypeId}</label>
						</div>  
						<div class="span7">
							<div id="acctgTransTypeIdTran"></div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.glJournalId}</label>
						</div>  
						<div class="span7">
							<div id="glJournalIdTran"></div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label class="asterisk">${uiLabelMap.accPartyId}</label>
						</div>  
						<div class="span7">
							<div id="partyIdTran"><div id="jqxGridPartyId"></div></div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label class='asterisk'>${uiLabelMap.FormFieldTitle_transactionDate}</label>
						</div>  
						<div class="span7">
							<div id="transactionDateTran"></div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_isPosted}</label>
						</div>  
						<div class="span7">
							<div id="isPostedTran"></div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_inventoryItemId}</label>
						</div>  
						<div class="span7">
							<input id="inventoryItemIdTran"/>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_receiptId}</label>
						</div>  
						<div class="span7">
							<input id="receiptIdTran"/>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_voucherRef}</label>
						</div>  
						<div class="span7">
							<input id="voucherRefTran" />
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_invoiceId}</label>
						</div>  
						<div class="span7">
							<div id="invoiceIdTran">
								<div id="jqxGridInvoice"></div>
							</div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.accProductId}</label>
						</div>  
						<div class="span7">
							<div id="productIdTran">
					       		<div id="jqxGridProd"></div>
					       	</div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_shipmentId}</label>
						</div>  
						<div class="span7">
							<div id="shipmentIdTran">
					       		<div id="jqxGridShip"></div>
					       </div>
				   		</div>
				   	</div>
				   	<div class='row-fluid margin-bottom10'>
				   		<div class='span5 text-algin-right'>
							<label>${uiLabelMap.description}</label>
						</div>  
						<div class="span7">
							<textarea id="descriptionTran" class='text-popup' rows="3"></textarea>
				   		</div>
				   	</div>
				</div>
				<div class='span6'>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label class="asterisk">${uiLabelMap.glFiscalTypeId}</label>
						</div>
						<div class="span7">
							<div id="glFiscalTypeIdTran">
							</div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_reconcileStatus}</label>
						</div>
						<div class="span7">
							<div id="groupStatusIdTran">
							</div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label>${uiLabelMap.roleTypeId}</label>
						</div>
						<div class="span7">
							<div id="roleTypeIdTran">
								<div id="jqxgridRoleTypeIdTran">
								</div>
							</div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_postedDate}</label>
						</div>
						<div class="span7">
							<div id="scheduledPostingDateTran"></div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.postedDate}</label>
						</div>
						<div class="span7">
							<div id="postedDateTran"></div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label>${uiLabelMap.paymentId}</label>
						</div>
						<div class="span7">
				       		<div id="paymentIdTran">
				       			<div id="jqxGridPay"></div>
				       		</div>
				       	</div>
					</div>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_workEffortId}</label>
						</div>
						<div class="span7">
							<div id="workEffortIdTran" >
				       			<div id="jqxGridWE"></div>
				       		</div>
				       	</div>
					</div>
					<div class='row-fluid margin-bottom10'>
					    <div class='span5 text-algin-right'>
							<label>${uiLabelMap.FixedAssetId}</label>
						</div>
						<div class="span7">
							<div id="fixedAssetIdTran">
								<div id="fixedAssetJqx"></div>
							</div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_voucherDate}</label>
						</div>
						<div class="span7">
							<div id="voucherDateTran"></div>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_finAccountTransId}</label>
						</div>
						<div class="span7">
							<input id="finAccountTransIdTran"/>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_physicalInventoryId}</label>
						</div>
						<div class="span7">
							<input id="physicalInventoryIdTran"/>
						</div>
					</div>
					<div class='row-fluid margin-bottom10'>
						<div class='span5 text-algin-right'>
							<label>${uiLabelMap.FormFieldTitle_theirAcctgTransId}</label>
						</div>
						<div class="span7">
							<input id="theirAcctgTransIdTran"/>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="form-action">
			<button id="cancel" class='btn btn-danger form-action-button pull-right'><i class='fa-remove'></i> ${uiLabelMap.CommonCancel}</button>
			<button id="saveAndContinue" class='btn btn-success form-action-button pull-right'><i class='fa-plus'></i> ${uiLabelMap.SaveAndContinue}</button>
			<button id="save" class='btn btn-primary form-action-button pull-right'><i class='fa-check'></i> ${uiLabelMap.CommonSave}</button>
		</div>
	</div>
</div>
<script type="text/javascript">
	<#assign listInv = delegator.findByAnd("InvoiceType",null,null,false) !>
	 var listInvoiceType = [
	 	<#list listInv as inv>
	 	{
	 		'invoiceTypeId' : '${inv.invoiceTypeId?if_exists}',
	 		'description'  : '${StringUtil.wrapString(inv.get('description',locale))}'
	 	},
	 	</#list>
	 ]
	 
	 <#assign listShipmentType =  delegator.findByAnd("ShipmentType",null,null,false) !>
	 var listShipmentType = [
	 	<#list listShipmentType as inv>
	 	{
	 		'shipmentTypeId' : '${inv.shipmentTypeId?if_exists}',
	 		'description'  : "${StringUtil.wrapString(inv.get('description',locale))}"
	 	},
	 	</#list>
	 ]
	 
	  <#assign listSttShipment =  delegator.findByAnd("StatusItem",Static["org.ofbiz.base.util.UtilMisc"].toMap("statusTypeId","PURCH_SHIP_STATUS"),null,false) !>
	 var listSttShipment = [
	 	<#list listSttShipment as inv>
	 	{
	 		'statusId' : '${inv.statusId?if_exists}',
	 		'description'  : "${StringUtil.wrapString(inv.get('description',locale))}"
	 	},
	 	</#list>
	 ]
	 
	  <#assign listInvStatus =  delegator.findByAnd("StatusItem",Static["org.ofbiz.base.util.UtilMisc"].toMap("statusTypeId","INVOICE_STATUS"),null,false) !>
	 var listInvStatus = [
	 	<#list listInvStatus as inv>
	 	{
	 		'statusId' : '${inv.statusId?if_exists}',
	 		'description'  : "${StringUtil.wrapString(inv.get('description',locale))}"
	 	},
	 	</#list>
	 ]
	 
	 
	var initProductSelect = function(dropdown, grid){
		<#assign listProType = delegator.findByAnd("ProductType",null,null,false) !>
		var listProType = [
		                   <#list listProType as type >
		                   	{
		                   		'productTypeId'  : '${type.productTypeId}',
		                   		'description'  : '${StringUtil.wrapString(type.get('description',locale))}'	
		                   	},
		                   </#list>
		                   ]
		var datafields = [{ name: 'productId', type: 'string' },
			{ name: 'brandName', type: 'string' },
			{ name: 'internalName', type: 'string' },
		 	{ name: 'productTypeId', type: 'string' }];
        var columns = [{ text: '${uiLabelMap.FormFieldTitle_productId}', datafield: 'productId', width: 150 },
		  	{ text: '${uiLabelMap.ProductBrandName}', datafield: 'brandName' },
		  	{ text: '${uiLabelMap.ProductInternalName}', datafield: 'internalName' },
		  	{ text: '${uiLabelMap.ProductProductType}', datafield: 'productTypeId',filtertype : 'checkedlist',cellsrenderer : function(row){
		  		var data = grid.jqxGrid('getrowdata',row);
		  		if(typeof(data) != 'undefined') {
		  			for(var i = 0 ;i < listProType.length ; i ++ ){
		  				if(listProType[i].productTypeId == data.productTypeId){
		  					return '<span>' +listProType[i].description + '</span>';	
		  				}
		  			}
		  		}
		  		return '<span>' + data.productTypeId+ '</span>';
		  	},createfilterwidget : function(row,value,widget){
		  		var records =  new Array();
		  		if(listProType && listProType.length > 0){
		  			var filterbox = new $.jqx.dataAdapter(listProType,{autoBind : true});
		  			records = filterbox.records;
		  			records.splice(0,0,'${StringUtil.wrapString(uiLabelMap.wgfilterselectallstring)}');
		  		}else records = [];
		  		widget.jqxDropDownList({source : records,displayMember : 'description',valueMember : 'productTypeId'});
		  	}}];
    	GridUtils.initDropDownButton({url: "getListProduct",autoshowloadelement : false,autorowheight: true, filterable: true,source : { pagesize : 5,cache : false}},datafields,columns, null, grid,dropdown, "productId");
	};
	var initPartySelect = function(dropdown, grid, width){
		var datafields = [{ name: 'partyId', type: 'string' },
    		{ name: 'partyTypeId', type: 'string' },
        	{ name: 'firstName', type: 'string' },
        	{ name: 'lastName', type: 'string' },
        	{ name: 'groupName', type: 'string' }];
        var columns = [{ text: '${uiLabelMap.accApInvoice_partyId}', datafield: 'partyId', width: 200, pinned: true},
       		{ text: '${uiLabelMap.accApInvoice_partyTypeId}', datafield: 'partyTypeId', width: 200, 
				cellsrenderer: function(row, columns, value){
					var group = "${uiLabelMap.PartyGroup}";
					var person = "${uiLabelMap.Person}";
					if(value == "PARTY_GROUP"){
						return "<div class='custom-cell-grid'>"+group+"</div>";
					}else if(value == "PERSON"){
						return "<div class='custom-cell-grid'>"+person+"</div>";
					}
					return value;
				}
			},
			{ text: '${uiLabelMap.accAccountingFromParty}', datafield: 'groupName', width: 200},
			{ text: '${uiLabelMap.FormFieldTitle_firstName}', datafield: 'firstName', width: 200, 
				cellsrenderer: function(row, columns, value, defaulthtml, columnproperties, rowdata){
					var first = rowdata.firstName ? rowdata.firstName : "";
					var last = rowdata.lastName ? rowdata.lastName : "";
					return "<div class='custom-cell-grid'>"+ first + " " + last +"</div>";
				}
			}];
    	GridUtils.initDropDownButton({url: "getFromParty",autoshowloadelement : false, autorowheight: true, filterable: true, width: width ? width : 600,
    								 source: {cache: true, pagesize: 5}},datafields,columns, null, grid, dropdown, "partyId");
	};
	var initPaymentSelect = function(dropdown, grid){
		var datafields = [{ name: 'paymentId', type: 'string' },
			{ name: 'partyIdFrom', type: 'string' },
			{ name: 'partyIdTo', type: 'string' },
			{ name: 'fullNameTo', type: 'string' },
			{ name: 'fullNameFrom', type: 'string' },
			{ name: 'groupNameTo', type: 'string' },
			{ name: 'groupNameFrom', type: 'string' },
			{ name: 'effectiveDate', type: 'date' ,other: 'Timestamp'},
			{ name: 'amount', type: 'number' },
			{ name: 'currencyUomId', type: 'string'}];
        var columns = [{ text: '${uiLabelMap.paymentId}', datafield: 'paymentId', width: 150 },
			{ text: '${uiLabelMap.paymentFrom}', datafield: 'groupNameFrom', width: 150 ,cellsrenderer : function(row){
				var data = grid.jqxGrid('getrowdata',row);
				if(data.groupNameFrom){
					return '<span>' + data.groupNameFrom + '</span>';
				}else if(data.fullNameFrom){
					return '<span>' + data.fullNameFrom + '</span>';
				}else return ''; 
			}},
			{ text: '${uiLabelMap.paymentTo}', datafield: 'groupNameTo', width: 150 ,cellsrenderer : function(row){
				var data = grid.jqxGrid('getrowdata',row);
				if(data.groupNameTo){
					return '<span>' + data.groupNameTo + '</span>';
				}else if(data.fullNameTo){
					return '<span>' + data.fullNameTo + '</span>';
				}else return ''; 
			}},
			{ text: '${uiLabelMap.effectiveDate}', datafield: 'effectiveDate',cellsformat : 'dd/MM/yyyy',filtertype : 'range', width: 150 },
			{ text: '${uiLabelMap.amount}', datafield: 'amount', width: 100 ,filtertype : 'number',cellsformat : 'd'},
			{ text: '${uiLabelMap.currencyUomId}', datafield: 'currencyUomId'}
        ];
    	GridUtils.initDropDownButton({url: "getListPayment",autoshowloadelement : false, autorowheight: true, filterable: true, width: 900,dropdown : {dropDownHorizontalAlignment : true}, source: {cache: true, pagesize: 5}},
									datafields,columns, null, grid, dropdown, "paymentId");
	};
	var initAssetsSelect = function(dropdown, grid){
		var datafields = [{ name: 'fixedAssetId', type: 'string'},
					 	 { name: 'fixedAssetName', type: 'string'},
					 	 { name: 'fixedAssetTypeId', type: 'string'},
					 	 { name: 'parentFixedAssetId', type: 'string'},
					 	 { name: 'dateAcquired', type: 'date', other: 'Timestamp'},
						 { name: 'expectedEndOfLife', type: 'date', other: 'Timestamp'},
						 { name: 'purchaseCost', type: 'number'},
						 { name: 'salvageValue', type: 'number'},
						 { name: 'depreciation', type: 'number'},
						 { name: 'plannedPastDepreciationTotal', type: 'number'}];
        var columns = [{ text: '${StringUtil.wrapString(uiLabelMap.AccountingFixedAssetId)}', datafield: 'fixedAssetId', width: 150, cellsrenderer:
				       function(row, colum, value){
					        var data = grid.jqxGrid('getrowdata', row);
			        		return '<span><a href="' + 'EditFixedAsset?fixedAssetId=' + data.fixedAssetId + '">' + data.fixedAssetId + '</a></span>';
			         }},
					 { text: '${StringUtil.wrapString(uiLabelMap.AccountingFixedAssetName)}', datafield: 'fixedAssetName', width: 200},
					 { text: '${StringUtil.wrapString(uiLabelMap.AccountingFixedAssetTypeId)}', datafield: 'fixedAssetTypeId', width: 150, filtertype: 'checkedlist',
						 	cellsrenderer: function (row, column, value) {
								var data = grid.jqxGrid('getrowdata', row);
	        						for(i = 0 ; i < fixedAssetTypeData.length; i++){
	        							if(data.fixedAssetTypeId == fixedAssetTypeData[i].fixedAssetTypeId){
	        								return '<span title=' + value +'>' + fixedAssetTypeData[i].description + '</span>';
	        							}
	        						}
	        						
	        						return '<span title=' + value +'>' + value + '</span>';
	    						},
	    					createfilterwidget: function (column, columnElement, widget) {
				   				var filterBoxAdapter2 = new $.jqx.dataAdapter(fixedAssetTypeData,
				                {
				                    autoBind: true
				                });
				   				var uniqueRecords2 = filterBoxAdapter2.records;
				   				uniqueRecords2.splice(0, 0, '(${StringUtil.wrapString(uiLabelMap.filterselectallstring)})');
				   				widget.jqxDropDownList({ source: uniqueRecords2, displayMember: 'fixedAssetTypeId', valueMember : 'fixedAssetTypeId', height: '21px',renderer: function (index, label, value) 
								{
									for(i=0;i < uniqueRecords2.length; i++){
										if(uniqueRecords2[i].roleTypeId == value){
											return uniqueRecords2[i].description;
										}
									}
								    return value;
								}});
								widget.jqxDropDownList('checkAll');
				   			}
					 	},
	                    { text: '${StringUtil.wrapString(uiLabelMap.FormFieldTitle_dateAcquired)}', width:150, datafield: 'dateAcquired', cellsformat: 'dd/MM/yyyy', filtertype: 'range'},
	                    { text: '${StringUtil.wrapString(uiLabelMap.FormFieldTitle_expectedEndOfLife)}', width:220, datafield: 'expectedEndOfLife', cellsformat: 'dd/MM/yyyy', filtertype: 'range'},
						{ text: '${StringUtil.wrapString(uiLabelMap.FormFieldTitle_purchaseCost)}', width:150,filtertype  : 'number', datafield: 'purchaseCost', cellsrenderer:
							 	function(row, colum, value){
							 		var data = grid.jqxGrid('getrowdata', row);							 		
							 		return "<span>" + formatcurrency(data.purchaseCost,data.purchaseCostUomId) + "</span>";
							 	}},
						{ text: '${StringUtil.wrapString(uiLabelMap.FormFieldTitle_salvageValue)}', width:150,filtertype : 'number', datafield: 'salvageValue', cellsrenderer:
						 	function(row, colum, value){
						 		var data = grid.jqxGrid('getrowdata', row);
						 		return "<span>" + formatcurrency(data.salvageValue,data.purchaseCostUomId) + "</span>";
						 	}},
						{ text: '${StringUtil.wrapString(uiLabelMap.AccountingDepreciation)}', width:150,filtertype :'number', datafield: 'depreciation', cellsrenderer:
						 	function(row, colum, value){
						 		var data = grid.jqxGrid('getrowdata', row);
						 		return "<span>" + formatcurrency(data.depreciation,data.purchaseCostUomId) + "</span>";
						 	}},							 							 	
	                    { text: '${StringUtil.wrapString(uiLabelMap.accPlannedPastDepreciationTotal)}',filtertype : 'number', datafield: 'plannedPastDepreciationTotal', cellsrenderer:
						 	function(row, colum, value){
					 		var data = grid.jqxGrid('getrowdata', row);
					 		return "<span>" + formatcurrency(data.plannedPastDepreciationTotal,data.purchaseCostUomId) + "</span>";
					 	}}
        ];
    	GridUtils.initDropDownButton({url: "listFixedAssetsJqx",autoshowloadelement : false, autorowheight: true, filterable: true, width: 800,dropdown : {dropDownHorizontalAlignment : true}, source: {cache: true, pagesize: 3}},
									datafields,columns, null, grid, dropdown, "fixedAssetId");
	};
	
	var initInvoiceSelect = function(dropdown, grid){
			var datafields = [{ name: 'invoiceId', type: 'string' },
				{ name: 'invoiceTypeId', type: 'string' },
				{ name: 'partyIdFrom', type: 'string' },
				{ name: 'partyId', type: 'string' },
				{ name: 'fullNameFrom', type: 'string' },
				{ name: 'fullNameTo', type: 'string' },
				{ name: 'groupNameFrom', type: 'string' },
				{ name: 'groupNameTo', type: 'string' },
				{ name: 'statusId', type: 'string' },
				{ name: 'description', type: 'string'}];
            var columns = [{ text: '${uiLabelMap.FormFieldTitle_invoiceId}', datafield: 'invoiceId', width: 150 },
			  	{ text: '${uiLabelMap.FormFieldTitle_invoiceTypeId}',filtertype:'checkedlist', datafield: 'invoiceTypeId', width: 150,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
			  		for(var i = 0 ;i < listInvoiceType.length;i++){
			  			if(listInvoiceType[i].invoiceTypeId == data.invoiceTypeId){
			  				return '<span>' + listInvoiceType[i].description +'</span>';
			  			}
			  		}
			  		return '<span>' + data.invoiceTypeId +'</span>';
			  	} ,createfilterwidget : function(column,columnElement,widget){
				    	var source = {
				    		localdata : listInvoiceType,
				    		datatype : 'array'
				    	};
				    	var filterBoxAdapter = new $.jqx.dataAdapter(source,{autoBind : true});
				    	var uniRecords = filterBoxAdapter.records;
				    	uniRecords.splice(0, 0, '(${StringUtil.wrapString(uiLabelMap.filterselectallstring)})');
				    	widget.jqxDropDownList({source: uniRecords, displayMember: 'description', valueMember: 'invoiceTypeId',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}',renderer: function (index, label, value) 
									{
										for(i=0;i < listInvoiceType.length; i++){
											if(listInvoiceType[i].invoiceTypeId == value){
												return listInvoiceType[i].description;
											}
										}
									    return value;
									}});
				    }},
			  	{ text: '${uiLabelMap.partyIdFrom}', datafield: 'groupNameFrom', width: 150 ,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
					if(data.groupNameFrom){
						return '<span>' + data.groupNameFrom + '</span>';
					}else if(data.fullNameFrom){
						return '<span>' + data.fullNameFrom + '</span>';
					}else return ''; 
			  	}},
			  	{ text: '${uiLabelMap.partyIdTo}', datafield: 'groupNameTo', width: 150 ,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
					if(data.groupNameTo){
						return '<span>' + data.groupNameTo + '</span>';
					}else if(data.fullNameTo){
						return '<span>' + data.fullNameTo + '</span>';
					}else return ''; 
			  	}},
			  	{ text: '${uiLabelMap.statusId}', datafield: 'statusId',filtertype : 'checkedlist', width: 150,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
			  		for(var key in listInvStatus){
			  			if(listInvStatus[key].statusId == data.statusId){
			  				return '<span>' + listInvStatus[key].description +'</span>';
			  			}
			  		}
			  		return '<span>' + data.statusId + '</span>';
		  		},createfilterwidget : function(column,columnElement,widget){
				    	var source = {
				    		localdata : listInvStatus,
				    		datatype : 'array'
				    	};
				    	var filterBoxAdapter = new $.jqx.dataAdapter(source,{autoBind : true});
				    	var uniRecords = filterBoxAdapter.records;
				    	uniRecords.splice(0, 0, '(${StringUtil.wrapString(uiLabelMap.filterselectallstring)})');
				    	widget.jqxDropDownList({source: uniRecords, displayMember: 'description', valueMember: 'statusId',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}',renderer: function (index, label, value) 
							{
								for(i=0;i < listInvStatus.length; i++){
									if(listInvStatus[i].statusId == value){
										return listInvStatus[i].description;
									}
								}
							    return value;
							}});
				    } },
			  	{ text: '${uiLabelMap.description}', datafield: 'description', width: 200}];
	    	GridUtils.initDropDownButton({url: "getListInvoice",autoshowloadelement : false, autorowheight: true, filterable: true, source: {cache: true, pagesize: 3}},
    									datafields,columns, null, grid, dropdown, "invoiceId");
		};
		
		var initWorkEffortSelect = function(dropdown, grid){
			<#assign listWorkType = delegator.findByAnd("WorkEffortType",null,null,false) !>
			var listWorkType = [
			                    <#list listWorkType as type>
			                    {
	                    			'workEffortTypeId' : '${type.workEffortTypeId}',
	                    			'description' : '${type.get('description',locale)}'
			                    },
			                    </#list>
		                    ];
			var datafields = [{ name: 'workEffortId', type: 'string' },
				{ name: 'workEffortName', type: 'string' },
				{ name: 'workEffortTypeId', type: 'string' },
				{ name: 'contactMechTypeId', type: 'string' }];
				
            var columns = [{ text: '${uiLabelMap.FormFieldTitle_workEffortId}', datafield: 'workEffortId', width: 150 },
				{ text: '${uiLabelMap.FormFieldTitle_workEffortName}', datafield: 'workEffortName', width: 150 },
				{ text: '${uiLabelMap.FormFieldTitle_workEffortTypeId}', datafield: 'workEffortTypeId',filtertype : 'checkedlist', width: 200 ,cellsrenderer : function(row){
					var data = grid.jqxGrid('getrowdata',row);
					if(typeof(data) != 'undefined') {
						for(var i = 0 ;i < listWorkType.length;i++){
							if(listWorkType[i].workEffortTypeId == data.workEffortTypeId){
								var name = (listWorkType[i].description != null) ? listWorkType[i].description : '';
								return '<span>' + name	  + '</span>';
							}
						}
					}
					var name = (data.workEffortTypeId != null) ? data.workEffortTypeId : '';
					return '<span>' + name + '</span>';
				},createfilterwidget : function(row,value,widget){
					var records = [];
					if(listWorkType && listWorkType.length > 0){
						var filterDt = new $.jqx.dataAdapter(listWorkType,{autoBind : true});
						records = filterDt.records;
						records.splice(0,0,'${StringUtil.wrapString(uiLabelMap.wgfilterselectallstring)}');
					}
					widget.jqxDropDownList({source : records,displayMember : 'description',valueMember : 'workEffortTypeId'});
				}},
				{ text: '${uiLabelMap.FormFieldTitle_contactMechTypeId}', datafield: 'contactMechTypeId'}];
	    	GridUtils.initDropDownButton({url: "getListWorkEffort",autoshowloadelement : false ,autorowheight: true, filterable: true, width: 800,dropdown : {dropDownHorizontalAlignment: true}, source: {cache: true, pagesize: 5}},
	    								datafields,columns, null, grid, dropdown, "workEffortId");
		};
		var initShipmentSelect = function(dropdown, grid){
			var datafields = [{ name: 'shipmentId', type: 'string' },
				{ name: 'shipmentTypeId', type: 'string' },
				{ name: 'statusId', type: 'string' },
				{ name: 'partyIdFrom', type: 'string' },
				{ name: 'partyIdTo', type: 'string' },
				{ name: 'fullNameTo', type: 'string' },
				{ name: 'fullNameFrom', type: 'string' },
				{ name: 'groupNameTo', type: 'string' },
				{ name: 'groupNameFrom', type: 'string' }
				];
            var columns = [{ text: '${uiLabelMap.ShipmentId}', datafield: 'shipmentId', width: 150 },
				{ text: '${uiLabelMap.FormFieldTitle_shipmentTypeId}', datafield: 'shipmentTypeId',filtertype : 'checkedlist', width: 150 ,cellsrenderer : function(row){
					var data = grid.jqxGrid('getrowdata',row);
					for(var key in listShipmentType){
						if(listShipmentType[key].shipmentTypeId == data.shipmentTypeId){
							return  '<span>' + listShipmentType[key].description +'</span>';
						}
					}
					return data.shipmentTypeId;
				},createfilterwidget : function(row,column,widget){
					var filterBox = new $.jqx.dataAdapter(listShipmentType,{autoBind : true});
					var records = filterBox.records;
					records.splice(0,0,'(${StringUtil.wrapString(uiLabelMap.filterselectallstring)})'); 
					widget.jqxDropDownList({source : records,displayMember : 'description',valueMember : 'shipmentTypeId'});	
				}},
				{ text: '${uiLabelMap.statusId}', datafield: 'statusId', width: 150 ,filtertype : 'checkedlist',cellsrenderer : function(row){
					var data = grid.jqxGrid('getrowdata',row);
					for(var key in listSttShipment){
						if(listSttShipment[key].statusId == data.statusId){
							return '<span>' + listSttShipment[key].description + '</span>';
						}
					}
					return '<span>' + data.statusId + '</span>';
				},createfilterwidget : function(row,column,widget){
					var filterBox = new $.jqx.dataAdapter(listSttShipment,{autoBind : true});
					var records = filterBox.records;
					records.splice(0,0,'(${StringUtil.wrapString(uiLabelMap.filterselectallstring)})'); 
					widget.jqxDropDownList({source : records,displayMember : 'description',valueMember : 'statusId'});	
				}},
				{ text: '${uiLabelMap.partyIdFrom}', datafield: 'groupNameFrom', width: 150 ,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
					if(data.groupNameFrom){
						return '<span>' + data.groupNameFrom + '</span>';
					}else if(data.fullNameFrom){
						return '<span>' + data.fullNameFrom + '</span>';
					}else return ''; 
			  	}},
				{ text: '${uiLabelMap.partyIdTo}', datafield: 'groupNameTo', width: 150 ,cellsrenderer : function(row){
			  		var data = grid.jqxGrid('getrowdata',row);
					if(data.groupNameTo){
						return '<span>' + data.groupNameTo + '</span>';
					}else if(data.fullNameTo){
						return '<span>' + data.fullNameTo + '</span>';
					}else return ''; 
			  	}}];
	    	GridUtils.initDropDownButton({url: "getListShipment",autoshowloadelement : false, autorowheight: true, filterable: true,dropdown : {dropDownHorizontalAlignment : false}, source: {cache: true, pagesize: 5}},
	    								datafields,columns, null, grid, dropdown, "shipmentId");
		};
	var acc = (function(){
		$.jqx.theme = 'olbius';
		theme = $.jqx.theme;
		var outFilterCondition = "";
		var organizationPartyId = "${parameters.organizationPartyId?if_exists}";
		var form = $('#accTransaction');
		var initWindow = function(){
			$("#accTransaction").jqxWindow({
				width: 1000, height: 700, maxWidth: 1000, minWidth: 900,maxHeight : 1000 ,resizable: true,  isModal: true, autoOpen: false, cancelButton: $("#cancel"), modalOpacity: 0.7, theme:theme           
			});
			$("#accTransaction").on("close", function(){
				clearForm();
				form.jqxValidator("hide");
			});
		};
		var initDropDownRole = function(){
			GridUtils.initDropDownButton({url : 'getListRoleType',autoshowloadelement : false,width : 450,filterable : true,dropdown : {dropDownHorizontalAlignment : true},source : {pagesize : 5,cache : false}},
				[
					{name : 'roleTypeId',type : 'string'},
					{name : 'description',type : 'string'}
				], 
				[
					{text : '${uiLabelMap.roleTypeId}',datafield : 'roleTypeId'},
					{text : '${uiLabelMap.description}',datafield : 'description'}
				]
				, null, $('#jqxgridRoleTypeIdTran'),$('#roleTypeIdTran'),'roleTypeId');
		}
		var initElement = function(){
			$("#acctgTransTypeIdTran").jqxDropDownList({filterable :true, theme: theme, source: acctgTransTypesData, displayMember: "description", valueMember: "acctgTransTypeId", width: '200', height: '25',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}'});
			$("#glFiscalTypeIdTran").jqxDropDownList({ theme: theme,autoDropDownHeight : true, source: glFiscalTypesData, displayMember: "description", valueMember: "glFiscalTypeId", width: '200', height: '25',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}'});
			$("#glJournalIdTran").jqxDropDownList({ theme: theme, source: glJournalsData,autoDropDownHeight : true, displayMember: "description", valueMember: "glJournalId", width: '200', height: '25',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}'});
			$("#groupStatusIdTran").jqxDropDownList({ theme: theme,autoDropDownHeight : true, source: statusItemsData, displayMember: "description", valueMember: "statusId", width: '200', height: '25',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}'});
			$("#finAccountTransIdTran").jqxInput({width:195});
			initDropDownRole();
			$('#inventoryItemIdTran').jqxInput({width:195});
			$('#physicalInventoryIdTran').jqxInput({width:195});
			$('#receiptIdTran').jqxInput({width:195});
			$('#theirAcctgTransIdTran').jqxInput({width:195});
			$('#voucherRefTran').jqxInput({width:195});
			$("#voucherDateTran").jqxDateTimeInput({width: '200px', height: '25px', formatString: 'dd/MM/yyyy hh:mm:ss',clearString: '${uiLabelMap.Clear}', todayString: '${uiLabelMap.Today}',showFooter:true});
			$("#voucherDateTran").jqxDateTimeInput('val', null);
			$("#isPostedTran").jqxDropDownList({ autoDropDownHeight : true,theme: theme, source: isPostedData, displayMember: "description", valueMember: "isPosted", width: '200', height: '25',placeHolder : '${StringUtil.wrapString(uiLabelMap.PleaseChooseAcc?default(''))}'});
			$("#postedDateTran").jqxDateTimeInput({width: '200px', height: '25px', formatString: 'dd/MM/yyyy hh:mm:ss',clearString: '${uiLabelMap.Clear}', todayString: '${uiLabelMap.Today}',showFooter:true});
			$("#postedDateTran").jqxDateTimeInput('val', null);
			$("#transactionDateTran").jqxDateTimeInput({width: '200px', height: '25px', formatString: 'dd/MM/yyyy hh:mm:ss',clearString: '${uiLabelMap.Clear}', todayString: '${uiLabelMap.Today}',showFooter:true});
			$("#transactionDateTran").jqxDateTimeInput('val', null);
			$("#scheduledPostingDateTran").jqxDateTimeInput({width: '200px', height: '25px', formatString: 'dd/MM/yyyy hh:mm:ss', clearString: '${uiLabelMap.Clear}',todayString: '${uiLabelMap.Today}',showFooter:true});
			$("#scheduledPostingDateTran").jqxDateTimeInput('val', null);
			setTimeout(function(){
				initPartySelect($("#partyIdTran"), $("#jqxGridPartyId"));
				initInvoiceSelect($("#invoiceIdTran"), $("#jqxGridInvoice"));
				initPaymentSelect($("#paymentIdTran"), $("#jqxGridPay"));
				initWorkEffortSelect($("#workEffortIdTran"), $("#jqxGridWE"));
				initShipmentSelect($("#shipmentIdTran"), $("#jqxGridShip"));
				initProductSelect($("#productIdTran"), $("#jqxGridProd"));
				initAssetsSelect($("#fixedAssetIdTran"), $("#fixedAssetJqx"));	
			}, 100);
		};
		
		var bindEvent = function(){
			$("#save").click(function () {
				if(!acc.save()){
					return;
				}
		        form.jqxWindow('close');
			}); 
			$("#saveAndContinue").click(function () {
				if(!acc.save()){
					return;
				}
				clearForm();
			}); 
		};
		var save = function(){
			if(!validateForm()){
				return;
			}
			var row = getFormData();
	        $("#listTran").jqxGrid('addRow', null, row, "first");
	        $("#listTran").jqxGrid('clearSelection');                        
	        $("#listTran").jqxGrid('selectRow', 0); 
	        return true;
		};
		var validateForm = function(){
			return form.jqxValidator("validate");
		};
		var getFormData = function(){
			var index = $('#acctgTransTypeIdTran').jqxDropDownList("getSelectedItem");
			var acctgTransTypeId = index && index.value ? index.value : "";
			index = $('#glFiscalTypeIdTran').jqxDropDownList("getSelectedItem");
			var glFiscalTypeId = index && index.value ? index.value : "";
			index = $('#glJournalIdTran').jqxDropDownList("getSelectedItem");
			var glJournalId = index && index.value ? index.value : "";
			index = $('#glJournalIdTran').jqxDropDownList("getSelectedItem");
			var glJournalId = index && index.value ? index.value : "";
			index = $('#groupStatusIdTran').jqxDropDownList("getSelectedItem");
			var groupStatusId = index && index.value ? index.value : "";
			index = $("#jqxGridPay").jqxGrid("getselectedrowindex");
			var payment = $("#jqxGridPay").jqxGrid("getrowdata", index);
			var paymentId = payment && payment.paymentId ? payment.paymentId : "";
			index = $("#jqxGridProd").jqxGrid("getselectedrowindex");
			var product = $("#jqxGridProd").jqxGrid("getrowdata", index);
			var productId = product && product.productId ? product.productId : "";
			index = $("#jqxGridWE").jqxGrid("getselectedrowindex");
			var workEffort = $("#jqxGridWE").jqxGrid("getrowdata", index);
			var workEffortId = workEffort && workEffort.workEffortId ? workEffort.workEffortId : "";
			index = $("#jqxGridShip").jqxGrid("getselectedrowindex");
			var shipment = $("#jqxGridShip").jqxGrid("getrowdata", index);
			var shipmentId = shipment && shipment.shipmentId ? shipment.shipmentId : "";
			index = $("#fixedAssetJqx").jqxGrid("getselectedrowindex");
			var asset = $("#fixedAssetJqx").jqxGrid("getrowdata", index);
			var fixedAssetId = asset && asset.fixedAssetId ? asset.fixedAssetId : "";
			index = $("#jqxGridInvoice").jqxGrid("getselectedrowindex");
			var invoice = $("#jqxGridInvoice").jqxGrid("getrowdata", index);
			var invoiceId = invoice && invoice.invoiceId ? invoice.invoiceId : "";
			index = $('#roleTypeIdTran').jqxDropDownButton("val");
			var roleTypeId = index ? index : "";
			index = $("#jqxGridPartyId").jqxGrid("getselectedrowindex");
			var party = $("#jqxGridPartyId").jqxGrid("getrowdata", index);
			var partyId = party && party.partyId ? party.partyId : "";
			var voucherDate = $('#voucherDateTran').jqxDateTimeInput('getDate');
			var postedDate = $('#postedDateTran').jqxDateTimeInput('getDate');
			var scheduledPostingDate = $('#scheduledPostingDateTran').jqxDateTimeInput('getDate');
			var transactionDate = $('#transactionDateTran').jqxDateTimeInput('getDate');
			return { 
			 	organizationPartyId: organizationPartyId,
        		acctgTransTypeId: acctgTransTypeId, 
        		glFiscalTypeId: glFiscalTypeId,
        		glJournalId: glJournalId,
        		groupStatusId:groupStatusId,
        		finAccountTransId:$("#finAccountTransIdTran").val(),
        		inventoryItemId:$('#inventoryItemIdTran').val(),
        		physicalInventoryId:$('#physicalInventoryId').val(),
        		receiptId:$('#receiptIdTran').val(),
        		theirAcctgTransId:$('#theirAcctgTransIdTran').val(),
        		voucherRef:$('#voucherRefTran').val(),
        		voucherDate: voucherDate ? voucherDate.getTime() : "",
        		isPosted:$('#isPostedTran').val(),
        		postedDate: postedDate ? postedDate.getTime() : "",
        		partyId:partyId,
        		roleTypeId:roleTypeId,
        		invoiceId:invoiceId,
        		paymentId:paymentId,
        		productId:productId,
        		workEffortId:workEffortId,
        		shipmentId:shipmentId,
        		fixedAssetId:fixedAssetId,
        		scheduledPostingDate: scheduledPostingDate ? scheduledPostingDate.getTime() : "",
        		transactionDate: transactionDate ? transactionDate.getTime() : "",
        		description:$('#descriptionTran').val()
		    };
		};
		var clearForm = function(){
			$("#acctgTransTypeIdTran").jqxDropDownList('clearSelection');
			$("#glFiscalTypeIdTran").jqxDropDownList('clearSelection');
			$("#glJournalIdTran").jqxDropDownList('clearSelection');
			$("#groupStatusIdTran").jqxDropDownList('clearSelection');
			$("#finAccountTransId").jqxInput('val','');
			$("#roleTypeIdTran").jqxDropDownButton('val', '');
			$('#inventoryItemIdTran').jqxInput('val','');
			$('#physicalInventoryIdTran').jqxInput('val', '');
			$('#receiptIdTran').jqxInput('val', '');
			$('#theirAcctgTransIdTran').jqxInput('val','');
			$('#voucherRefTran').jqxInput('val','');
			$("#voucherDateTran").jqxDateTimeInput('val', null);
			$("#isPostedTran").jqxDropDownList('clearSelection');
			$("#postedDateTran").jqxDateTimeInput('val', null);
			$("#transactionDateTran").jqxDateTimeInput('val', null);
			$("#postedDateTran").jqxDateTimeInput('val', null);
			$("#scheduledPostingDateTran").jqxDateTimeInput('val', null);
			$('#productIdTran').val('');
			$('#shipmentIdTran').val('');
			$('#partyIdTran').jqxDropDownButton('val','');
			$('#invoiceIdTran').val('');
			$('#paymentIdTran').val('');
			$('#workEffortIdTran').val('');
			$('#fixedAssetIdTran').val('');
		};
		var initRule = function(){
			form.jqxValidator({
		        	rules: [{
		        	input: "#acctgTransTypeIdTran", message: "${uiLabelMap.CommonRequired}", action: 'blur change', 
		        	rule: function (input, commit) {
		                var index = input.jqxDropDownList('getSelectedIndex');
		                return index != -1;
		            }
		   		},{
		        	input: "#partyIdTran", message: "${uiLabelMap.CommonRequired}", action: 'change,close', 
		        	rule: function (input, commit) {
		                var index = input.jqxDropDownButton('val');
		               if(!index) return false;
		               return true;
		            }
		   		},{
		        	input: "#glFiscalTypeIdTran", message: "${uiLabelMap.CommonRequired}", action: 'blur change', 
		        	rule: function (input, commit) {
		                var index = input.jqxDropDownList('getSelectedIndex');
		                return index != -1;
		            }
		   		},{
		        	input: "#transactionDateTran", message: "${uiLabelMap.CommonRequired}", action: 'blur change', 
		        	rule: function (input, commit) {
		                var index = input.jqxDateTimeInput('getDate');
		                if(index){
		                	return true;
		                }
		                return false;
		            }
		   		}]
		    });
		};
		return {
			init : function(){
				initWindow();
				initElement();
				initRule();
				bindEvent();	
			},
			save : save
		};
	}());
	$(document).ready(function(){
		acc.init();
	});
</script>